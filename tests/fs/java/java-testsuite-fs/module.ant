<!--
	ANT
	
	Copyright 2020 MicroEJ Corp. All rights reserved.
	Use of this source code is governed by a BSD-style license that can be found with this software.
-->
<project name="jpf.testsuite.fs" xmlns:ea="antlib:org.apache.easyant" xmlns:ivy="antlib:org.apache.ivy.ant"  xmlns:ac="antlib:net.sf.antcontrib">
	
	<dirname file="${ant.file.jpf.testsuite.fs}" property="project"/>
	<dirname file="${project}" property="workspace.dir"/>
	
	<fail unless="external.scripts.dir" message="Set the 'external.scripts.dir' property" />
	<!-- sanity check -->
	<fail message="Cannot find ${external.scripts.dir}/build.bat or ${external.scripts.dir}/run.bat">
		<condition>
			<or>
				<not>
					<available file="${external.scripts.dir}/build.bat" type="file" />
				</not>
				<not>
					<available file="${external.scripts.dir}/run.bat" type="file" />
				</not>
			</or>
		</condition>
	</fail>
	<property name="microej.testsuite.properties.external.scripts.dir" location="${external.scripts.dir}"/>
	
	<fail unless="deploy.dir.microejapp" message="Set the 'deploy.dir.microejapp' property" />
	<property name="microej.testsuite.properties.deploy.script" value="deployInBSP.xml"/>
	<property name="microej.testsuite.properties.deploy.dir.microejapp" location="${deploy.dir.microejapp}"/>
		
	<!-- We should rename the embPartialLink launch to fullLink if a fullLink does not exist and an embPartialLink exist -->
	<target name="jpf:rename-launch-check">
		<condition property="should.rename.launch">
			<and>
				<available file="${microej-testsuite.platform.dir}/scripts/embPartialLink.microejLaunch" type="file" />
				<not>
					<available file="${microej-testsuite.platform.dir}/scripts/fullLink.microejLaunch" type="file" />
				</not>
			</and>
		</condition>
	</target>
	<target name="jpf:rename-launch" depends="jpf:rename-launch-check" if="should.rename.launch" extensionOf="microej-testsuite:test-ready">
		<move file="${microej-testsuite.platform.dir}/scripts/embPartialLink.microejLaunch" 
			tofile="${microej-testsuite.platform.dir}/scripts/fullLink.microejLaunch" />
	</target>
</project>